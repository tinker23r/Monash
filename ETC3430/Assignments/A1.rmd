---
title: "ETC3430 Assignment 1"
author: "Chelaka Paranahewa"
output: 
  html_document:
    fig_crop: false
    
---
    
```{r Setup}
library(tidyverse)
library(readxl)
library(expm)
setwd("C:/Users/chela/GitHub Local Repo/Uni-Work/ETC3430/Assignments/")
set.seed(31455034)
```

# Question 1
## Part E
```{r, fig.width = 9, fig.height = 5, warning=FALSE}
set.seed(3149)
P <- matrix(
    data = c(0.45, 0.35, 0.20, 0.36, 0.34, 0.30, 0.25, 0.65, 0.10),
    nrow = 3, ncol = 3, byrow = TRUE
)

# Cumulative Probability
CP <- t(apply(P, 1, cumsum))
n <- 100

repeater <- function(sim_size) {
    X <- matrix(0, sim_size + 1, 1)
    X[1, 1] <- 1
    for (day in 1:3) {
        for (i in 1:sim_size) {
            u <- runif(1)
            X[i + 1, 1] <- 1 * (u < CP[X[i, 1], 1]) +
                2 * (u < CP[X[i, 1], 2]) * (u > CP[X[i, 1], 1]) +
                3 * (u > CP[X[i, 1], 2])
        }

        g <- X %>%
            as_tibble() %>%
            ggplot(aes(x = V1)) +
            geom_histogram() +
            labs(
                title = paste("Day ", day),
                subtitle = paste("n =  ", sim_size),
                x = "State"
            )
        print(g)
    }
}
sims <- c(100, 1000, 10000, 100000)
for (index in 1:4) {
    repeater(sims[index])
    print(index)
}
```

```{r}
P <- matrix(
    data = c(0.45, 0.35, 0.20, 0.36, 0.34, 0.30, 0.25, 0.65, 0.10), # these are my vals so pls change lol
    nrow = 3, ncol = 3, byrow = TRUE
)

# Cumulative Probability
CP <- t(apply(P, 1, cumsum))
n <- 10000000

X <- matrix(0, n + 1, 1)
X[1, 1] <- 1

for (i in 1:n) {
    u <- runif(1)
    X[i + 1, 1] <- 1 * (u < CP[X[i, 1], 1]) +
        2 * (u < CP[X[i, 1], 2]) * (u > CP[X[i, 1], 1]) +
        3 * (u > CP[X[i, 1], 2])
}


pi <- matrix(0, 1, 3)
pi[1, 1] <- sum(X == 1) / n
pi[1, 2] <- sum(X == 2) / n
pi[1, 3] <- sum(X == 3) / n

pi %*% (P %^% 2)
c(1 / 3, 1 / 3, 1 / 3) %*% (P %^% 3)
```

## Part F
```{r}
# Compound Poisson Process
n <- 1e3
dt <- 10 / n
t <- dt * (1:n)
lambda <- 5
dN <- rpois(n, dt * lambda)
plot(t, cumsum(dN), type = "l")
X <- sapply(1:n, function(i) ifelse(dN[i] == 0, 0, rgamma(1, 1, 1)))
S <- cumsum(X)
plot(t, S, type = "l")

# Monte Carlo Simulation of S_1
n <- 1e4
t <- 1
N_1 <- rpois(n, lambda * t)
S <- rgamma(n, N_1, 1)
hist(S, breaks = 200)


S_exp <- sapply(1:n, function(i) sum(rexp(N_1[i])))
plot(density(S))
lines(density(S_exp), col = 2)
```

```{r}
set.seed(NULL)
repeater <- function(sim_size) {
    X <- matrix(1, sim_size + 1, 1)
    # X[1, 1] <- 1
    for (day in 2:3) {
        for (i in 1:sim_size) {
            u <- runif(1)
            X[i + 1, 1] <- 1 * (u < CP[X[i, 1], 1]) +
                2 * (u < CP[X[i, 1], 2]) * (u > CP[X[i, 1], 1]) +
                3 * (u > CP[X[i, 1], 2])
        }

        g <- X %>%
            as_tibble() %>%
            ggplot(aes(x = V1)) +
            geom_histogram() +
            labs(
                title = paste("Day ", day),
                subtitle = paste("n =  ", sim_size),
                x = "State"
            )
        print(g)
    }
}
repeater(100)
```

pseudo

day = Sunny
run individual sims of someone living thru day 2 and day 3
repeat 100, 1000, 10000, 100000

return probability of day being not Sunny