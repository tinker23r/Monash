---
title: "ETC3430 Assignment 1"
author: "Chelaka Paranahewa"
output: 
  html_document:
    fig_crop: false
    
---
    
```{r Setup}
library(tidyverse)
library(readxl)
library(expm)
library(glue)
setwd("C:/Users/chela/GitHub Local Repo/Uni-Work/ETC3430/Assignments/")
set.seed(31455034)
```

# Question 1
## Part E
```{r, fig.width = 9, fig.height = 5, warning=FALSE}
set.seed(3149)
P <- matrix(
    data = c(0.45, 0.35, 0.20, 0.36, 0.34, 0.30, 0.25, 0.65, 0.10),
    nrow = 3, ncol = 3, byrow = TRUE
)

# Cumulative Probability
CP <- t(apply(P, 1, cumsum))

repeater <- function(sim_size) {
    X <- matrix(0, sim_size + 1, 1)
    X[1, 1] <- 1
    for (day in 1:3) {
        for (i in 1:sim_size) {
            u <- runif(1)
            X[i + 1, 1] <- 1 * (u < CP[X[i, 1], 1]) +
                2 * (u < CP[X[i, 1], 2]) * (u > CP[X[i, 1], 1]) +
                3 * (u > CP[X[i, 1], 2])
        }

        g <- X %>%
            as_tibble() %>%
            ggplot(aes(x = V1)) +
            geom_histogram() +
            labs(
                title = paste("Day ", day),
                subtitle = paste("n =  ", sim_size),
                x = "State"
            )
        print(g)
    }
}
sims <- c(100, 1000, 10000, 100000)
for (index in 1:4) {
    repeater(sims[index])
}
```


## Part F
```{r}
## Part F
set.seed(NULL)
P <- matrix(
    data = c(0.45, 0.35, 0.20, 0.36, 0.34, 0.30, 0.25, 0.65, 0.10), # these are my vals so pls change lol
    nrow = 3, ncol = 3, byrow = TRUE
)

# Cumulative Probability
CP <- t(apply(P, 1, cumsum))
markov_proc_del_start <- function(sim_size, starting_day) {
    X <- matrix(1, sim_size + 1, 1)
    for (day in starting_day:3) {
        for (i in 1:sim_size) {
            u <- runif(1)
            X[i, 1] <- 1 * (u < CP[X[i, 1], 1]) +
                2 * (u < CP[X[i, 1], 2]) * (u > CP[X[i, 1], 1]) +
                3 * (u > CP[X[i, 1], 2])
        }
    }
    pi <- matrix(0, 1, 3)
    pi[1, 1] <- sum(X == 1) / sim_size
    pi[1, 2] <- sum(X == 2) / sim_size
    pi[1, 3] <- sum(X == 3) / sim_size
    return(pi)
}

sims <- c(100, 1000, 10000, 100000)
for (index in 1:4) {
    print(glue("Simulation size: {sims[index]}"))
    print(markov_proc_del_start(sims[index], 2))
    cat("\n")
    cat("\n")
}

theory <- c(1, 0, 0) %*% (P %^% 2)
print(glue("Theoretical Value:"))
print(theory)
```

## Part G
```{r}
## Part G
sims <- c(100, 1000, 10000, 100000)
for (index in 1:4) {
    print(glue("Simulation size: {sims[index]}"))
    print(markov_proc_del_start(sims[index], 3))
    cat("\n")
    cat("\n")
}
theory <- c(1, 0, 0) %*% (P %^% 1)
print(glue("Theoretical Value:"))
print(theory)
```

# Question 3
```{r}
data_sheet2 <- read_excel("Data.xlsx", sheet = 2) %>%
    select(Dataset1, Dataset2)

data_sheet2 <- data_sheet2[-c(1), ]
states <- tibble(state = rep(1:2, times = length(data_sheet2$Dataset1) / 2 + 1))
states <- states[-c(length(data_sheet2$Dataset1) + 1), ]
data_sheet2 <- data_sheet2 %>% cbind(states)
data_sheet2 <- transform(
    data_sheet2,
    Dataset1 = as.numeric(Dataset1),
    Dataset2 = as.numeric(Dataset2)
)
data_sheet2 <- data_sheet2 %>% as_tibble()

lambda_states <- data_sheet2 %>%
    select(Dataset1, state) %>%
    group_by(state) %>%
    summarise(lambda = 1 / mean(Dataset1))

# Make intensity matrix
```